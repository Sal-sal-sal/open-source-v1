# Руководство по голосовым сообщениям

## Обзор

Система голосовых сообщений позволяет пользователям записывать голосовые заметки в Audio Chat, которые автоматически транскрибируются в текст и могут быть использованы для создания заметок.

## Как использовать

### 1. Запись голосового сообщения

1. **Откройте Audio Chat** (`/audio-chat/:chatId`)
2. **Найдите секцию "Voice Message"** внизу страницы
3. **Нажмите на красную кнопку с микрофоном** для начала записи
4. **Говорите в микрофон** - вы увидите индикатор записи и таймер
5. **Нажмите на серую кнопку со стопом** для остановки записи

### 2. Прослушивание записи

После остановки записи:
- **Нажмите на синюю кнопку с треугольником** для прослушивания
- **Нажмите на серую кнопку с корзиной** для удаления записи
- **Запишите новое сообщение** если нужно

### 3. Отправка и транскрипция

1. **Нажмите "Send Voice Message"** для отправки
2. **Дождитесь транскрипции** - появится индикатор "Transcribing..."
3. **Получите результат** - транскрибированный текст появится в уведомлении

## Технические особенности

### Поддерживаемые форматы
- **WebM** (основной формат для записи)
- **MP3** (для загруженных файлов)
- **WAV** (для загруженных файлов)
- **M4A** (для загруженных файлов)
- **OGG** (для загруженных файлов)

### Требования к браузеру
- **HTTPS соединение** (для доступа к микрофону)
- **Разрешение на микрофон** в браузере
- **Современный браузер** с поддержкой MediaRecorder API

### Ограничения
- **Максимальная длина записи**: не ограничена (но рекомендуется до 5 минут)
- **Качество записи**: зависит от микрофона и браузера
- **Транскрипция**: использует OpenAI Whisper API или Groq API (автоматический выбор с fallback)

## Устранение неполадок

### Проблема: "Failed to start recording"
**Решение:**
1. Проверьте разрешения микрофона в браузере
2. Убедитесь, что сайт открыт по HTTPS
3. Попробуйте обновить страницу

### Проблема: "Failed to transcribe audio"
**Решение:**
1. Проверьте подключение к интернету
2. Убедитесь, что запись не пустая
3. Попробуйте записать сообщение заново

### Проблема: Микрофон не работает
**Решение:**
1. Проверьте настройки микрофона в системе
2. Убедитесь, что микрофон не используется другими приложениями
3. Попробуйте другой браузер

## API Endpoints

### Транскрипция аудио
```
POST /api/audio/transcript/
Content-Type: multipart/form-data

Parameters:
- file: Audio file (webm, mp3, wav, m4a, ogg)
- current_time: Optional - current playback time
- total_duration: Optional - total file duration
- service: Optional - "openai", "groq", or "auto" (default)
```

### Информация о доступных сервисах
```
GET /api/audio/transcription-services
Content-Type: application/json

Returns:
{
  "openai": {
    "available": true,
    "name": "OpenAI Whisper",
    "model": "whisper-1"
  },
  "groq": {
    "available": true,
    "name": "Groq Whisper",
    "model": "whisper-large-v3-turbo"
  },
  "preferred": "auto"
}
```

### Загрузка аудио файла
```
POST /api/audio/load
Content-Type: multipart/form-data

Parameters:
- file: Audio file
```

## Компоненты

### VoiceRecorder
- **Файл**: `study/src/components/VoiceRecorder.tsx`
- **Функции**: Запись, воспроизведение, удаление, транскрипция
- **Стили**: Glass effect с backdrop blur

### AudioChatView
- **Файл**: `study/src/pages/AudioChatView.tsx`
- **Интеграция**: VoiceRecorder компонент
- **Обработка**: Загрузка и обработка голосовых сообщений

## Безопасность

- **HTTPS обязателен** для доступа к микрофону
- **Разрешения запрашиваются** у пользователя
- **Аудио данные** не сохраняются без разрешения
- **Транскрипция** происходит через защищенное API

## Будущие улучшения

- [ ] Сохранение голосовых сообщений в истории
- [ ] Редактирование транскрибированного текста
- [ ] Поддержка языков кроме английского
- [ ] Автоматическое создание заметок из транскрипции
- [ ] Интеграция с AI чатом для ответов на голосовые сообщения 